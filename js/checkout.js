//DATASET
// Lista de productos
const productList = [];
productList.push({
    id: 'producto1', // Agregar un ID único
    name: 'CurcKua Bolsa de guitarra ajustable para concierto, acústica suave',
    price: 319.00,
    image: 'https://m.media-amazon.com/images/I/41907QbWViL._AC_SL1099_.jpg',
    category: 'accesorios',
    description: `Descripción

Bolsas ajustables para guitarra con forro grueso de esponja, la bolsa de guitarra ayuda a proteger tu guitarra de cualquier posible daño. Mayor capacidad, permite que la funda de guitarra se adapte a la guitarra de hasta 41 pulgadas. Alfombrilla de goma antideslizante en la parte inferior que evita que se resbale al estar de pie. Bolsa exterior ideal para guardar accesorios. Ayuda a proteger de golpes y rasguños. Se adapta a todas las marcas y modelos de guitarras acústicas y clásicas de tamaño completo.

Características
Bolsa para guitarra
- Color: negro.
- Material: tela Oxford 600D.
- Tamaño: 41.7 x 16.5 x 5.1 pulgadas.
Dureza: suave.
Añade grosor de algodón: 5 mm.
Aplicar a: guitarra acústica de 40/41 pulgadas.
Peso: 600 g.

El paquete incluye:
1 bolsa para guitarra`,
});
productList.push({
    id: 'producto2',
    name: `Juego de 50 picks o púas para Guitarra Eléctrica y Acústica`,
    price: 189.00,
    image: 'https://img.kwcdn.com/product/open/2023-07-30/1690698104633-4010ba994fcc4d5290e169785e991077-goods.jpeg?imageView2/2/w/800/q/70/format/webp',
    category: 'accesorios',
    description: `caracteristicas:
    Hecho de material de celuloide de alta calidad, la selección es fuerte y duradera. Mano de obra fina y superficie lisa, cómoda y fácil de usar. Viene con 50 selecciones, para tus necesidades de uso prolongado. Thin one es más adecuado para barrer y Thick one es más adecuado para romper acordes y tocar notas individuales. Adecuado para varias guitarras populares, la calidad del tono es más clara y agradable.
    
    
    Presupuesto:
    
    Condición: 100% a estrenar
    
    Material: celuloide
    
    Peso aproximado. 20-28 g / 0.7-1.0 oz
    
    Color: envío aleatorio
    
    Tamaño: Aprox. 3 * 2.6 cm / 1.2 * 1.0in
    
    Opciones de espesor: 0.46 mm, 0.7 mm
    
    
    
    Lista de paquetes:
    
    50 * Elegir`,
});
productList.push({
    id: 'producto3',
    name: 'Ernie Ball Regular Slinky - Cuerdas para bajo de escala corta',
    price: 339.56,
    image: 'https://m.media-amazon.com/images/I/81DxAh8L4bL._AC_SL1500_.jpg',
    category: 'accesorios',
    description: `Cuerdas de bajo Slinky de escala corta
    Uno de los líderes mundiales en cuerdas de bajo eléctrico. Durante más de 50 años, las cuerdas de guitarra eléctrica Ernie Ball Slinky han sido las favoritas de los músicos de todo el mundo, la receta de la firma de Ernie Ball consta de medidores específicos y proporciones de núcleo para envolver para armónicos ricos y equilibrados y esa sensación de Slinky. Utilizando las materias primas más finas y frescas, cada cuerda se fabrica en el clima seco del sur de California utilizando tecnología de bobinado de última generación y sometiendo a estrictos estándares de control de calidad. Las cuerdas de bajo bajo Slinky están hechas de acero chapado en níquel envuelto alrededor de un núcleo de acero de alto carbono chapado en estaño para un tono equilibrado que complementa todos los tipos de bajos eléctricos y estilos de juego. Cada juego está empaquetado en un ambiente de humedad ultra baja con el embalaje Element Shield de Ernie Ball para garantizar que cada juego esté tan fresco como el día en que se hizo.`,
});

productList.push({
    id: 'producto4',
    name: `Ernie Ball Earthwood Extra Light - Cuerdas para guitarra acústica`,
    price: 150.24,
    image: 'https://m.media-amazon.com/images/I/81PiVCVe4xL._AC_SL1500_.jpg',
    category: 'accesorios',
    description: `Cuerdas para guitarra acústica Earthwood 80/20 Bronze
    Fabricadas con un alambre con 80 % de cobre y 20 % de cinc entorchado sobre un núcleo hexagonal de acero chapado en latón. Las cuerdas para acústica Ernie Ball 80/20 Bronze producen un sonido cristalino y brillante con armónicos agradables. Disponibles en Extra Light (10-50), Light (11-52), Custom Light (11.5-54), Medium Light (12-54), Custom Medium (12.5-56), Medium (13-56), Rock and Blues (10-52),12-String Light (9-46), 12-string Custom Light (10-48) y 12-String Medium (11-28).`,
});
productList.push({
    id: 'producto5',
    name: 'Violín acústico',
    price: 1199.00,
    image: 'https://images.unsplash.com/photo-1612225330812-01a9c6b355ec?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=870&q=80',
    category: 'instrumentos',
    description: `Descripción del producto
    【Violín para principiantes】: Este violín es un instrumento de cuerda ideal para cualquier estudiante con sueños musicales y puede satisfacer todas las necesidades de los principiantes que comienzan a aprender. Asegúrese de manipularlos con cuidado para proteger la apariencia y el sonido del violín de su hijo`,
});
productList.push({
    id: 'producto6',
    name: `DSP 1260D - Bafle Activo 12" - 600W RMS`,
    price: 6020.00,
    image: 'https://http2.mlstatic.com/D_NQ_NP_603010-MLA43969125776_112020-O.webp',
    category: 'audio-prof',
    description: `La etapa de potencia de toda la serie DSP está basada en amplificaciones clase D, esto garantiza el mayor aprovechamiento de energía, entregando calidad sonora.
    
    CARACTERISTÍCAS
Gabinete multifuncional para uso como monitor de piso o PA principal compacto
Altavoz de 12”
Potencia 600W RMS
Alimentación 120V~60Hz
4 Presets de EQ.
Incluye DSP
    `,
});
productList.push({
    id: 'producto7',
    name: 'YAMAHA Guitarra clásica serie C',
    price: 3220.00,
    image: 'https://m.media-amazon.com/images/I/61ybL4ZAZ4L._AC_SL1500_.jpg',
    category: 'instrumentos',
    description: `Yamaha CM40 Guitarra Clásica Acústica
    Perfecta para principiantes
    
    La CM40 es la versión mate de nuestra clásica de iniciación más famosa, la C40. Una fina capa de laca satinada proporciona un tacto más agradable y suave
    
    Un alto nivel de fabricación artesanal y una gran atención al detalle dan como resultado instrumentos de excelente calidad.
    
    Las guitarras de la serie C son instrumentos con una magnífica relación costo-prestaciones para principiantes y jóvenes estudiantes, y que ofrecen gran comodidad al tocar y un sonido formidable.`,
});
productList.push({
    id: 'producto8',
    name: 'YAMAHA GB1KPE Piano de Cola Negro',
    price: 274999.20,
    image: 'https://images.pexels.com/photos/322719/pexels-photo-322719.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1',
    category: 'instrumentos',
    description: `GB1KPE Piano de Cola Yamaha Negro; Con su sonido magníficamente rico y su toque sensible, la serie GB1K evoca la emoción musical de un piano de cola, pero en una escala más compacta. La insistencia inflexible por conseguir un sonido y una resonancia excelentes, pone a nuestra disposición un piano a un precio asequible que se ajusta a tu espacio.

    SKU: 17092141 MODEL: PGB1KPE
    `,
});
productList.push({
    id: 'producto9',
    name: 'RIUKOE - Par de luces LED SlimPAR RGBW para DJ',
    price: 3383.22,
    image: 'https://m.media-amazon.com/images/I/61HSnhDE9SL._AC_SL1000_.jpg',
    category: 'iluminacion',
    description: `Fabricado de alta calidad
    Está construido con carcasa de aluminio fundido a presión, duradero y no plástico, y viene con piezas de materias primas de buena calidad como la fuente LED de Taiwán. Lo hace duradero y digno.
    
    Lavado ligero de colores brillantes
    Mientras que como construcción resistente, pequeña y delgada, todavía viene con salida de luz de alto brillo. Los datos Lux muestran que tiene una salida de hasta 8550 lux a 1 m
    
    Funcionamiento silencioso completo
    Adopta un disipador de calor y el diseño de la carcasa del hueco en el exterior para enfriar, por lo que el interior sin ventilador es completamente silencioso cuando trabajas, ilumina tu espacio sin ruido.`,
});
productList.push({
    id: 'producto10',
    name: 'TRIXTER Luces De Escenario,',
    price: 359.12,
    image: 'https://m.media-amazon.com/images/I/61JJLB1f0zL._AC_SL1200_.jpg',
    category: 'iluminacion',
    description: `TRIXTER CAÑON 36*3W
    Lámpara LED para diversión de tus fiestas tipo DJ, con 36leds RGB de 3W cada uno, 6 en 1, funciona automáticamente y con sonido(música), variables colores de luz para intercambiar (rojo, verde y azul), maestro esclavo (es decir controla uno o más procesos), (no incluye cables), botón de menú, botones para cambiar el modo de luz que desee, conectores de entrada y salida, base articulada y cable de luz led integrado, base articulada desarmable, y 2 tornillos.
    
    Los colores cambian de acuerdo al modo del menú que elija.
    
    Este cañón, cuenta con LED´s RGB individuales, es decir, en cada LED, están los tres colores: Rojo, Verde y Azul.
    
    RECOMENDACIONES:
    
    NO EXCEDERSE DEL VOLTAJE RECOMENDADO
    NO VER DIRECTAMENTE LA LUZ LED AL PRENDERLO
    PRECAUCIONES:
    
    NO SE DEJE EXPUESTO AL RAYO DEL SOL DE MANERA PROLONGADA
    NO SE DEJE AL ALCANCE DE NIÑOS MENORES DE 3 AÑOS
    CONTENIDO:
    
    INCLUYE BASE ARTICULADA
    
    NO INCLUYE CABLES DE ENTRADA Y SALIDA DE AUDIO XLR`,
});
productList.push({
    id: 'producto11',
    name: 'Sistema de Columna Activa NT 1000',
    price: 21000,
    image: 'https://149476031.v2.pressablecdn.com/wp-content/uploads/2023/08/NT1000-melo-4.webp',
    category: 'audio-prof',
    description: `NT1000 es la respuesta de MELO a los profesionales que trabajan en lugares donde la estética es
    un tema fundamental, que requieren gran potencia en equipos compactos.
    
    CARACTERISTÍCAS
    NT1000
    • Columna activa.
    • Equipado con un amplificador de 1000W RMS.
    • Sonido potente y claro.
    • 129 db SPL pico.

    NT1000 sistema activo de columna con un subwoofer
    de 15” de ferrita, 4 bocinas de 5” en neodimio y
    un driver de 1.75” de neodimio montado en una guía de onda
    plana, el bafle esta fabricado en triplay de 15mm.`,
});
productList.push({
    id: 'producto12',
    name: 'Micrófono WM301 - Melo Sound Of Music',
    price: 10500,
    image: 'https://melosoundofmusic.com.mx/wp/wp-content/uploads/2023/02/WM-301-catalogo-768x570.png',
    category: 'microfonia',
    description: `El nuevo WM301 brinda un excelente sonido, claridad y seguridad. Sistema inalámbrico dedicado a oradores, cantantes, guitarristas o bajistas que requieren un sistema inalámbrico profesional a un excelente precio. Se conforma por una cápsula lavalier, una diadema, cable TS para instrumento, transmisor y receptor, ¡3 opciones de conexión en un solo equipo!
    CARACTERÍSTICAS
Modo de Modulación:
Banda ancha FM
Rango de Frecuencia:
640 – 690 MHz
Respuesta de Frecuencia de audio:
30-20KHz/±2dB
Relación Señal / Ruido:
96 dB
Distorsión:
≤0.1%
Distancia de Trabajo / Alcance:
Hasta 200 metros.
    `,
});

productList.push({
    id: 'producto13',
    name: 'RF 100 - Micrófono Inalámbrico',
    price: 4300.00,
    image: 'https://melosoundofmusic.com.mx/wp/wp-content/uploads/2023/02/RF-100-2048x1121.png',
    category: 'microfonia',
    description: `El sistema de micrófono inalámbrico, fácil de instalar y conveniente de usar, es la primera
    opción para cantantes. Este modelo adopta hardware criptográfico inteligente, para lograr un
    sonido y un rendimiento de RF únicos.

    Caracteristicas:
    * Modo de Modulación: Banda ancha FM
    * Rango de Frecuencia: 640 – 690 MHz
    * Respuesta de Frecuencia de audio: 30-20KHz/±2dB
    * Relación Señal / Ruido: 96 dB
    * Distorsión: ≤0.1%
    * Distancia de Trabajo / Alcance: Hasta 200 metros
    
    RECEPTOR
    `,
});

productList.push({
    id: 'producto14',
    name: 'RF 200B - Micrófono Inalámbrico',
    price: 7800,
    image: 'https://resources.claroshop.com/medios-plazavip/mkt/6595a22a139ba_rf-200bjpg.jpg',
    category: 'microfonia',
    description: `La nueva generacion de los RF-200, el sistema de micrófono inalámbrico, fácil de instalar y conveniente de usar, es la primera
    opción para cantantes. Este modelo adopta hardware criptográfico inteligente, para lograr un
    sonido y un rendimiento de RF únicos.

    Caracteristicas:
    * Modo de Modulación: Banda ancga FM
    * Rango de Frecuencia: 740-790 MHz
    * Respuesta de Freciencia de Audio_ 40 Hz 18 kHz (3 dB)
    * Relación señal/Ruido: 105 dB
    * Distorsión: 0.3%
    * Distancia de trabajo/Alcance: Alrededor de 50 m.
    
    RECEPTOR
    - Modo de receptor : Automático
    `,
});

productList.push({
    id: 'producto15',
    name: 'KC11 Micrófono de condensador profesional',
    price: 2500,
    image: 'https://krieg.mx/gallery/KC11_1_uakegicm.png',
    category: 'microfonia',
    description: `Conoce una opcion a tu alcance de un microfono para grabación con todas las ventajas de uno pro a un precio 
    verdaderamente increíble.

    Especificaciones: 
    Micrófono de condensador con cápsula dorada y diafragma grande.
    Respuesta en frecuencia: 20Hz – 20kHz
    Patrón polar: Cardioide
    Sensibilidad: -34dB +/- 3dB (0dB = 1V / Pa @ 1kHz)
    Máximo nivel de presión sonora:  135dB (1kHZ con 1% T.H.D.)
    Alimentación de +48 volts (Phantom Power)
    Ruido propio relativamente bajo
    Amplio rango dinámico de 135dB

    `,
});

productList.push({
    id: 'producto16',
    name: 'K511 Micrófono multi propósito',
    price: 450,
    image: 'https://krieg.mx/images/k511galeria.png',
    category: 'microfonia',
    description: `La familia K500 de Krieg®, son micrófonos dinámicos de mano del tipo multi propósito de bajo costo. 
    Con un patrón unidireccional, su mejor aplicación es para voz, en donde la pastilla cardioide minimiza el feedback y las 
    reflexiones de piso de otras fuentes sonoras. Disponen de switch de encendido / apagado e incluye cable con conector de 
    XLR/6.3 mm (1/4”) que facilita su conectividad.

    Caracteristicas

    Cápsula: Dinámico
    Patrón Polar: Cardioide
    Frecuencia: 70 ˜ 14 000 Hz
    Sensibilidad: -75 dB ± 3 dB (0dB = 1 ubar @ 1 KHz)
    `,
});

productList.push({
    id: 'producto17',
    name: 'Batería Tornado 5 Piezas TND5254TCFJ MAPEX',
    price: 14700,
    image: 'https://hermesmusicclub.mx/cdn/shop/files/c887dc9d-09c6-40ff-b41a-530510551390_747x690.jpg?v=1704807568',
    category: 'instrumentos',
    description: `La batería Tornado Series de Mapex, es un set de batería completo con todo el hardware incluido, Tornado ofrece accesibilidad y facilidad de montaje para el baterista que toca por primera vez sin sacrificar la calidad del sonido. Los tambores están fabricados en madera de Poplar y cuentan con el SONIClear Bearing Edge de Mapex que, provoca que la afinación sea más simple y duradera, pero al mismo tiempo, brinda a la batería un tono mucho más rico y controlado.
    El Bombo de 22" ofrece unos graves contundentes y profundos, mientras que los Toms de tamaño completo, brindan una gran potencia y nitidez para un gran sonido.
    Bombo 22x16".
    Tarola 14x5.
    Tom1 12x9".
    Tom2 13x10".
    Tom de piso 16x16".
    Platillos 14" y 16”.
    Color Brown Wood Grain.
    Platillos: Hi-Hats 14” y Crash 16”.
    Hardware incluido (Atriles, Pedal para Bombo y Banco).
    Este producto cuenta con 1 año de garantía por defecto de fábrica.
    `,
});

productList.push({
    id: 'producto18',
    name: 'Cabeza Móvil Led De 15w Efecto Disco Mini Ball Lite Tek',
    price: 2158,
    image: 'https://lite-tek.com.mx/wp-content/uploads/2023/03/MiniBall.jpg',
    category: 'iluminacion',
    description: `MiniBALL es una cabeza móvil de leds, que proyecta múltiples haces de
    colores RGBW emulando el efecto de una bola de cristal de los 70’s,
    pero con movimiento.
    
    Lámpara: LED de 15W
    Modos de operación: DMX512, Audio, Auto, Master/Slave
    Efectos: Rayos delgados que giran en ambos sentidos
    RGBW
    Dimmer 0-100% mecánico
    11 Canales DMX
    Estrobo: 1-20 veces por segundo
    Display
    IP20
    Voltaje: 110 240V~ 50-60Hz 35W
    `,
});

productList.push({
    id: 'producto19',
    name: 'Destellador de luz S-PAR54',
    price: 1672,
    image: 'https://www.cyberpuerta.mx/img/product/M/CP-MEGALUZ-PAR54*1RGB-4de87a.jpg',
    category: 'iluminacion',
    description: `El destellador de luz S-PAR54 es un producto de la marca Megaluz. Cuenta con 54 luces LED de alta potencia que permiten 
    crear efectos de luz en una amplia gama de colores, incluyendo ambar, azul, rojo y verde.

    Parámetros  TécnicosÑ
    Voltaje: 85-265V~ 60HZ
    Consumo de corriente: 80W
    Color: RGB 3 IN 1
    Modos DMX: 6CH

    `,
});

productList.push({
    id: 'producto20',
    name: 'M215-A - Bafle activo doble 15',
    price: 32500,
    image: 'https://melosoundofmusic.com.mx/wp/wp-content/uploads/2023/05/M-215-cat-logo-276x300.png',
    category: 'audio-prof',
    description: `
    
    `,
});

productList.push({
    id: 'producto21',
    name: 'M21-A - Subwoofer de 21"',
    price: 39900,
    image: 'https://melosoundofmusic.com.mx/wp/wp-content/uploads/2023/06/M21-A-Frente-2.png',
    category: 'audio-prof',
    description: `
    El M-21A es un subwoofer de alto desempeño ideal para la serie M e incluso otras series como los sistemas lineales.

    INFORMACIÓN
    Cuenta con configuración Bass Reflex, amplificador de 300W RMS.
    Una bocina de 21″, presets de configuración para adaptarse a cualquier evento.
    Las conexiones son sencillas, la señal proveniente de una mezcladora, procesador o controlador se insertan al sistema. no hay una regla a seguir, puedes conectar directamente a los satélites o al subwoofer y de allí al siguiente bafle.
    Cuenta con entrada y salida de voltaje para<<puentear>> hasta dos subwoofers por linea.
    `,
});

const radioOptions = document.querySelectorAll('.radio-option input[type="radio"]');
const spanProviderShipping = document.querySelector('#providerShipping');
const spanPriceTotalShipping = document.querySelector('#totalShipping');
const infoIcon = document.getElementById('infoIcon');
const infoTooltip = document.getElementById('infoTooltip');
let tooltipTimeout;

let carritoGlobal = [];
let totalCarrito = 0 ;
let totalToPay = 0;
let selectedShippingProvider = null;
let globalShippingPrice = 0;

const shippingRates = {
    tresguerras:172.00,
    fedex:171.00,
    estafeta:205.00,
    castores:239.00
}

const shippingProviders = {
    name:{
        tresguerras:"TresGuerras",
        fedex:"FedEx",
        estafeta:"Estafeta",
        castores:"Castores"
    },
    description:{
        tresguerras:"Paquete entregado directamente a la puerta",
        fedex:"Paquete entregado directamente a la puerta",
        estafeta:"Paquete entregado directamente a su empresa",
        castores:"Recogida en punto de venta"
    }
}

carritoGlobal = JSON.parse(localStorage.getItem('carrito')) || [];
if (carritoGlobal.length === 0) {
    // Redirige al usuario a la página de inicio si el carrito está vacío
    window.location.href = '/index.html'; // Cambia esto por la URL de tu página de inicio
}

totalCarrito = calcularTotalCarrito(carritoGlobal);
// console.log("EL total del carrito es", totalCarrito );

document.addEventListener('DOMContentLoaded', function () {
    radioOptions.forEach(function(radio) {
        radio.addEventListener('change', function() {
          radioOptions.forEach(function(radio) {
            radio.parentNode.classList.remove('selected');
          });
          // Agregar la clase 'selected' solo al elemento seleccionado
          if (radio.checked) {
            radio.parentNode.classList.add('selected');
          }
        });
      });
      
    var inputs = document.querySelectorAll('input:not(#company)');

    inputs.forEach(function(input) {
        input.addEventListener('blur', function() {
            validateInput(this);
        });

        // Evento para comprobar los cambios en el campo
        input.addEventListener('input', function() {
            if (this.value.trim() !== '') {
                this.classList.remove('input-error');
                var errorMessage = this.parentElement.querySelector('.error-message');
                if (errorMessage) {
                    errorMessage.style.display = 'none';
                }
            }
        });
    });

    function validateInput(input) {
        var errorMessage = input.parentElement.querySelector('.error-message');
        if (input.value.trim() === '') {
            input.classList.add('input-error');
            if (errorMessage) {
                errorMessage.style.display = 'block';
            }
        } else {
            input.classList.remove('input-error');
            if (errorMessage) {
                errorMessage.style.display = 'none';
            }
        }
    }
      // Escucha el evento de toque
    infoIcon.addEventListener('touchstart', function(e) {
        // Previene el evento de clic en dispositivos móviles para evitar que se dispare dos veces
        e.preventDefault();
        toggleTooltip();
    });

    
});

  // Función para manejar la visibilidad del tooltip
  function toggleTooltip() {
    var isTooltipVisible = infoTooltip.style.visibility === 'visible';
    clearTimeout(tooltipTimeout);

    if (isTooltipVisible) {
      infoTooltip.style.visibility = 'hidden';
    } else {
      infoTooltip.style.visibility = 'visible';
      tooltipTimeout = setTimeout(function() {
        infoTooltip.style.visibility = 'hidden';
      }, 2400);
    }
  }

document.addEventListener('DOMContentLoaded', function () {
    // Selecciona el campo de entrada y el elemento de previsualización
    let fullNameInput = document.getElementById('full-name');
    const fullNamePreview = document.getElementById('preview-full-name');
    const companyInput = document.getElementById('company');
    var companyPreview = document.getElementById('preview-company');
    var emailInput = document.getElementById('email');
    var emailPreview = document.getElementById('preview-email');
    const phoneInput = document.getElementById('phone');
    const phonePreview = document.querySelector('#preview-phone');

    // Evento que se dispara cuando se escribe en el campo de nombre completo
    fullNameInput.addEventListener('input', function() {
        fullNamePreview.textContent = this.value;
    });

    companyInput.addEventListener('input', function() {
        companyPreview.textContent = this.value;
    });

    emailInput.addEventListener('input', function() {
        emailPreview.textContent = this.value;
    });

    phoneInput.addEventListener('input', function () {
        phonePreview.textContent = this.value;
    });

    document.querySelectorAll(".input-container .login-input").forEach(function(element) {
        if (element.value !== "") {
            element.closest('.input-container').classList.add("animation");
        }
    });

    const selectedOption = document.querySelector('input[name="delivery"]:checked');
    selectedShippingProvider = selectedOption.value;
    globalShippingPrice = calculateShipping(selectedShippingProvider, totalCarrito);
    renderShippingInfo(selectedShippingProvider);
    updateAllShippingCostsUI(totalCarrito);
});

document.querySelectorAll(".input-container .login-input").forEach(function(element) {
    element.addEventListener('focus', function() {
        this.closest('.input-container').classList.add("animation", "animation-color");
    });
});

document.querySelectorAll(".input-container .login-input").forEach(function(element) {
    element.addEventListener('focusout', function() {
        if (this.value === "") {
            this.closest('.input-container').classList.remove("animation");
        }
        this.closest('.input-container').classList.remove("animation-color");
    });
});

document.addEventListener('DOMContentLoaded', () => {
    renderactualizarTotalItems(carritoGlobal.length);

    function renderCart(arrayCarrito) {
        const contenedorProductos = document.querySelector(".my-order-content");
        contenedorProductos.innerHTML = ''; // Limpiar el contenedor existente
    
        arrayCarrito.forEach(producto => {
            // Crear el div del producto
            const productoDiv = document.createElement("div");
            productoDiv.classList.add("order-item");
    
            productDetails = productList.find(productFinder => producto.id === productFinder.id);
    
            // Agregar imagen, detalles y opciones del producto
            productoDiv.innerHTML = `
                <div class="item-image">
                    <img src="${productDetails.image}" alt="${productDetails.name}">
                </div>
                <div class="item-details">
                    <div class="nameAndPrice">
                        <h3 class="item-title">${productDetails.name}</h3>
                        <p class="item-price" id="price-${producto.id}">$${productDetails.price * producto.cantidad}</p>
                    </div>
                    <div class="item-options">
                    <select class="item-quantity" data-id="${producto.cantidad}">
                        <option value="1">1 pza</option>
                        <option value="2">2 pzas</option>
                        <option value="3">3 pzas</option>
                        <option value="4">4 pzas</option>
                        <option value="5">5 pzas</option>
                        <option value="6">6 pzas</option>
                        <option value="7">7 pzas</option>
                        <option value="8">8 pzas</option>
                        <option value="9">9 pzas</option>
                        <option value="10">10 pzas</option>
                    </select>
                </div>
                </div>
            `;
    
            // Establecer la cantidad seleccionada
            const selectCantidad = productoDiv.querySelector(".item-quantity");
            selectCantidad.value = producto.cantidad;
            // Asegurarse de que la opción actual esté disponible
            if (producto.cantidad > 10) {
            const option = document.createElement("option");
            option.value = producto.cantidad;
            option.textContent = `${producto.cantidad} pza${producto.cantidad > 1 ? 's' : ''}`;
            option.selected = true; // Marcar como seleccionada
            selectCantidad.appendChild(option);
            } else {
                selectCantidad.value = producto.cantidad;
            }

            // Añadir el event listener para cambios en la selección
            selectCantidad.addEventListener("change", function(event) {
                const nuevaCantidad = parseInt(event.target.value);
                actualizarPrecioProducto(producto.id, nuevaCantidad);
            });            
    
            // Agregar el producto al contenedor
            contenedorProductos.appendChild(productoDiv);
        });
    }

        // Función para actualizar la cantidad en el carrito
        function actualizarPrecioProducto(idProducto, nuevaCantidad) {
            // Encuentra el producto en productList por su ID para obtener el precio actualizado
            const productoEncontrado = productList.find(producto => producto.id === idProducto);
            if (productoEncontrado) {
                const precioTotal = nuevaCantidad * productoEncontrado.price;
                document.getElementById(`price-${idProducto}`).innerText = `$${precioTotal.toFixed(2)}`;
        
                // Actualiza la cantidad en carritoGlobal
                const productoEnCarrito = carritoGlobal.find(producto => producto.id === idProducto);
                if (productoEnCarrito) {
                    productoEnCarrito.cantidad = nuevaCantidad;
                }

                guardarCarritoEnLocalStorage();
            }
        }

    function guardarCarritoEnLocalStorage() {
        const jsonCart = JSON.stringify(carritoGlobal);
        localStorage.setItem('carrito', jsonCart);
    }


    function checkCartStatus() {
        if (carritoGlobal.length === 0) {
            console.log("El carrito esta vacio");
          document.getElementById('total-items').innerText = '0 items';
          document.getElementById('empty-cart-message').classList.remove('inactive');
        } else {
          // Actualizar el botón y otros elementos según sea necesario     // Escucha el evento de clic
        infoIcon.addEventListener('click', toggleTooltip);
        }
      }
      
    
    // Inicializar la vista con los productos del carrito
    renderCart(carritoGlobal);
});

function calculateShipping(shippingProvider, totalCart) {
    // Definición de tarifas basadas en el total del carrito
    let cartRate;
    if (totalCart > 0 && totalCart < 3000) {
        cartRate = 233;
    } else if (totalCart >= 3000 && totalCart < 10000) {
        cartRate = 400;
    } else if (totalCart >= 10000 && totalCart < 11000) {
        cartRate = 681;
    } else if (totalCart >= 11000 && totalCart < 25000) {
        cartRate = 700;
    } else if (totalCart >= 25000 && totalCart < 55000) {
        cartRate = 1100;
    } else if (totalCart >= 55000 && totalCart < 60000) {
        cartRate = 2633;
    } else if (totalCart >= 60000 && totalCart < 125000) {
        cartRate = 4000;
    } else if (totalCart >= 125000 && totalCart < 130000) {
        cartRate = 5950;
    } else if (totalCart >= 130000 && totalCart < 260000) {
        cartRate = 7000;
    } else if (totalCart >= 260000) {
        cartRate = 10000;
    } else {
        // Si el total del carrito es 0 o negativo, se podría manejar de manera especial
        console.log("Total del carrito inválido");
        return;
    }

    // Calcula el costo de envío basado en la paquetería y el total del carrito
    let shippingCost = shippingRates[shippingProvider.toLowerCase().replace(/\s/g, '')]; // Normaliza el nombre de la paquetería
    if (shippingCost === undefined) {
        console.log("Paquetería no reconocida");
        return;
    }

    // Suma la tarifa base de la paquetería con la tarifa basada en el total del carrito
    let totalShippingCost = cartRate + shippingCost;
    console.log("El costo total del envío es: ", totalShippingCost);
    return totalShippingCost;
}

function updateShippingCostUI(shippingProvider, shippingCost) {
    if (shippingCost !== undefined) {
        const formattedProvider = shippingProvider.charAt(0).toUpperCase() + shippingProvider.slice(1);
        document.getElementById(`price${formattedProvider}`).innerText = ` $${shippingCost}`;
    }
}

function updateAllShippingCostsUI(totalCart) {
    Object.keys(shippingRates).forEach(provider => {
        const shippingCost = calculateShipping(provider, totalCart);
        updateShippingCostUI(provider, shippingCost);
    });

    // Escuchadores de evento para actualizar la selección global
    document.querySelectorAll('input[name="delivery"]').forEach(radio => {
        radio.addEventListener('change', function() {
            selectedShippingProvider = this.value;
            globalShippingPrice = calculateShipping(selectedShippingProvider,totalCarrito);   
            renderShippingInfo(selectedShippingProvider);    
        });
    });
}

function renderShippingInfo(shippingProvider) {
    spanProviderShipping.innerText = shippingProviders.name[shippingProvider] + ' - ' + shippingProviders.description[shippingProvider];
    spanPriceTotalShipping.innerText = formatPrice(globalShippingPrice);    
}

function formatPrice(price) {
    return price.toLocaleString('es-MX', {
        style: 'currency',
        currency: 'MXN'
    });
}

function renderactualizarTotalItems() {
    const totalItems = document.querySelector('#total-items');
    if (totalItems) {
        totalItems.textContent = contarTotalItems(carritoGlobal) + " artículos";
    }
}

function contarTotalItems(carrito) {
    let totalItems = 0;

    for (let item of carrito) {
        totalItems += item.cantidad;
    }

    return totalItems;
}

// Función para buscar el precio de un producto por su ID
function buscarPrecioPorId(id) {
    const producto = productList.find(p => p.id === id);
    return producto ? producto.price : 0;
}

function calcularTotalCarrito(carrito) {
    return carrito.reduce((total, item) => {
        const precio = buscarPrecioPorId(item.id);
        return total + (precio * item.cantidad);
    }, 0);
}
